import{J as C,q as j,r as h,c as a,f as s,a as e,d as x,t as y,F as k,i as D,b as g,n as $,u as S,e as w,m as B,y as O,k as P,D as U,z as I,I as V,g as N,L as G,H as E,K as T}from"./index-Upsq31TS.js";import{D as R}from"./DashboardClientAssignmentStore-DpqDqqOP.js";import{L as u}from"./localeText-n7rlaTGQ.js";const q={class:"card rounded-0 border-0"},z={role:"button",class:"ms-auto text-white"},M={key:0,class:"bi bi-chevron-compact-down"},W={key:1,class:"bi bi-chevron-compact-up"},F={key:0,class:"card-body p-0"},H={class:"list-group list-group-flush"},J={key:0},K={class:"text-body"},Y={class:"text-muted"},Q={key:1},X={class:"text-body"},Z={class:"text-muted"},ee=["onClick"],se=["onClick"],L=C({__name:"availablePeersGroup",props:["configuration","peers","clientAssignedPeers","availablePeerSearchString"],emits:["assign","unassign"],setup(r,{emit:v}){const i=r,b=v,d=R(),o=j(()=>i.clientAssignedPeers&&Object.keys(i.clientAssignedPeers).includes(i.configuration)?i.peers.filter(f=>!i.clientAssignedPeers[i.configuration].map(t=>t.id).includes(f.id)&&(!i.availablePeerSearchString||i.availablePeerSearchString&&(f.id.includes(i.availablePeerSearchString)||f.name.includes(i.availablePeerSearchString)))):i.peers),p=h(!1),c=h(!1);return(f,t)=>(s(),a("div",q,[e("div",{onClick:t[0]||(t[0]=n=>c.value=!c.value),role:"button",class:"card-header rounded-0 sticky-top z-5 bg-body-secondary border-0 border-bottom text-white d-flex"},[e("small",null,[e("samp",null,y(r.configuration),1)]),e("a",z,[c.value?(s(),a("i",M)):(s(),a("i",W))])]),c.value?x("",!0):(s(),a("div",F,[e("div",H,[(s(!0),a(k,null,D(o.value,n=>(s(),a("div",{class:"list-group-item d-flex border-bottom list-group-item-action d-flex align-items-center gap-3",key:n.id},[p.value?(s(),a("div",Q,[e("small",X,[g(u,{t:"Are you sure to remove this peer?"})]),t[2]||(t[2]=e("br",null,null,-1)),e("small",Z,[e("samp",null,y(n.id),1)])])):(s(),a("div",J,[e("small",K,[e("samp",null,y(n.id),1)]),t[1]||(t[1]=e("br",null,null,-1)),e("small",Y,y(n.name?n.name:"Untitled Peer"),1)])),r.clientAssignedPeers?(s(),a("button",{key:2,onClick:l=>b("assign",n.id),class:$([{disabled:S(d).assigning},"btn bg-success-subtle text-success-emphasis ms-auto"])},t[3]||(t[3]=[e("i",{class:"bi bi-plus-circle-fill"},null,-1)]),10,ee)):(s(),a("button",{key:3,onClick:l=>b("unassign",n.assignment_id),class:$([{disabled:S(d).unassigning},"btn bg-danger-subtle text-danger-emphasis ms-auto"]),"aria-label":"Delete Assignment"},t[4]||(t[4]=[e("i",{class:"bi bi-trash-fill"},null,-1)]),10,se))]))),128))])]))]))}}),te={key:0,class:"d-flex rounded-0 border-0 flex-column d-flex flex-column border-bottom pb-1"},le={class:"d-flex flex-column p-3 gap-3"},ne={class:"d-flex align-items-center"},ae={class:"mb-0"},ie={class:"text-bg-primary badge ms-2"},oe={class:"text-bg-info badge ms-2"},re={class:"rounded-3 availablePeers border h-100 overflow-scroll flex-grow-1 d-flex flex-column"},de={key:0,class:"text-muted m-auto p-3"},ce={key:0,style:{height:"500px"},class:"d-flex flex-column p-3"},ue={class:"availablePeers border h-100 card rounded-3"},me={class:"card-header sticky-top p-3"},ge={class:"mb-0 d-flex align-items-center"},ve={class:"card-body p-0 overflow-scroll"},be={key:0,class:"text-muted m-auto"},fe={class:"card-footer d-flex gap-2 p-3 align-items-center justify-content-end"},he={key:1},pe=C({__name:"clientAssignedPeers",props:["client","clientAssignedPeers"],emits:["refresh"],setup(r,{emit:v}){const i=r,b=h(!1),d=R(),o=h(!1),p=v,c=async(n,l,m)=>{await d.assignClient(n,l,m,!1),p("refresh")},f=async n=>{await d.unassignClient(void 0,void 0,n),p("refresh")},t=h("");return(n,l)=>(s(),a("div",null,[b.value?(s(),a("div",he,l[8]||(l[8]=[e("div",{class:"p-3 placeholder-glow border-bottom"},[e("h6",{class:"placeholder w-100 rounded-3"}),e("div",{class:"placeholder w-100 rounded-3",style:{height:"400px"}})],-1)]))):(s(),a("div",te,[e("div",le,[e("div",ne,[e("h6",ae,[g(u,{t:"Assigned Peers"}),e("span",ie,[w(y(Object.keys(r.clientAssignedPeers).length)+" ",1),g(u,{t:Object.keys(r.clientAssignedPeers).length>1?"Configurations":"Configuration"},null,8,["t"])]),e("span",oe,[w(y(Object.values(r.clientAssignedPeers).flat().length)+" ",1),g(u,{t:Object.values(r.clientAssignedPeers).flat().length>1?"Peers":"Peer"},null,8,["t"])])]),e("button",{class:"btn btn-sm bg-primary-subtle text-primary-emphasis rounded-3 ms-auto",onClick:l[0]||(l[0]=m=>o.value=!o.value)},[o.value?(s(),a(k,{key:1},[l[5]||(l[5]=e("i",{class:"bi bi-check me-2"},null,-1)),l[6]||(l[6]=w("Done "))],64)):(s(),a(k,{key:0},[l[3]||(l[3]=e("i",{class:"bi bi-list-check me-2"},null,-1)),l[4]||(l[4]=w("Manage "))],64))])]),e("div",re,[(s(!0),a(k,null,D(r.clientAssignedPeers,(m,_)=>(s(),P(L,{configuration:_,peers:m,onUnassign:l[1]||(l[1]=async A=>await f(A))},null,8,["configuration","peers"]))),256)),Object.keys(r.clientAssignedPeers).length===0?(s(),a("h6",de,[g(u,{t:"No peer assigned to this client"})])):x("",!0)])]),o.value?(s(),a("div",ce,[e("div",ue,[e("div",me,[e("h6",ge,[g(u,{t:"Available Peers"})])]),e("div",ve,[(s(!0),a(k,null,D(S(d).allConfigurationsPeers,(m,_)=>(s(),P(L,{availablePeerSearchString:t.value,configuration:_,clientAssignedPeers:r.clientAssignedPeers,peers:m,onAssign:async A=>await c(_,A,i.client.ClientID)},null,8,["availablePeerSearchString","configuration","clientAssignedPeers","peers","onAssign"]))),256)),Object.keys(S(d).allConfigurationsPeers).length===0?(s(),a("h6",be,[g(u,{t:"No peer is available to assign"})])):x("",!0)]),e("div",fe,[l[7]||(l[7]=e("label",{for:"availablePeerSearchString"},[e("i",{class:"bi bi-search me-2"})],-1)),B(e("input",{id:"availablePeerSearchString","onUpdate:modelValue":l[2]||(l[2]=m=>t.value=m),class:"form-control form-control-sm rounded-3 w-auto",type:"text"},null,512),[[O,t.value]])])])])):x("",!0)]))]))}}),ye={class:"p-3 d-flex gap-3 flex-column border-bottom"},_e={class:"d-flex align-items-center"},xe={class:"mb-0"},ke=C({__name:"clientResetPassword",props:["client"],setup(r){const v=r,i=h(!1),b=h(!1),d=h(!1),o=h(!1),p=U();V();const c=t=>{const n=p.getActiveCrossServer();return n?new URL("/client/#/reset_password?token="+t,n.host).href:new URL("/client/#/reset_password?token="+t,window.location.href).href},f=async()=>{o.value=!0;let t=!1,n;await I("/api/clients/generatePasswordResetLink",{ClientID:v.client.ClientID},async l=>{if(l.status)if(n=l.data,b.value=!0,await N("/api/email/ready",{},m=>{t=m.status}),t){let m={Receiver:v.client.Email,Subject:"[WGDashboard | Client] Reset Password",Body:`Hi${v.client.Name?" "+v.client.Name:""},

We received a request to reset the password for your account. You can reset your password by visiting the link below:

${c(n)}

This link will expire in 30 minutes for your security. If you didn’t request a password reset, you can safely ignore this email—your current password will remain unchanged.

If you need help, feel free to contact support.

Best regards,
WGDashboard`};await I("/api/email/send",m,_=>{_.status?(d.value="Send email success.",i.value=!0):(d.value="Send email failed.",b.value=!1,i.value=!0)})}else d.value=`Please share this URL to your client to reset the password: ${c(n)}`,i.value=!0;else b.value=!1,d.value=l.message,i.value=!0}),o.value=!1};return(t,n)=>(s(),a("div",ye,[e("div",_e,[e("h6",xe,[g(u,{t:"Reset Password"})]),e("button",{class:$(["btn btn-sm bg-primary-subtle text-primary-emphasis rounded-3 ms-auto",{disabled:o.value}]),onClick:n[0]||(n[0]=l=>f())},[n[1]||(n[1]=e("i",{class:"bi bi-send me-2"},null,-1)),o.value?(s(),P(u,{key:1,t:"Sending..."})):(s(),P(u,{key:0,t:"Send Password Reset Link"}))],2)]),i.value?(s(),a("div",{key:0,class:$(["alert rounded-3 mb-0",[b.value?"alert-success":"alert-danger"]])},y(d.value),3)):x("",!0)]))}}),Pe={class:"p-4 border-bottom bg-body-tertiary"},we={class:"text-muted"},$e={class:"d-flex align-items-center"},Se={class:"text-muted"},Ce={class:"ms-auto"},Ae={style:{flex:"1 0 0","overflow-y":"scroll"}},De={key:1,class:"d-flex w-100 h-100 text-muted"},Re={class:"m-auto text-center"},Ne=C({__name:"clientViewer",async setup(r){let v,i;const b=R(),d=G(),o=j(()=>b.getClientById(d.params.id)),p=h({}),c=async()=>{await N("/api/clients/assignedPeers",{ClientID:o.value.ClientID},f=>{p.value=f.data})};return o.value&&(E(()=>o.value.ClientID,async()=>{await c()}),[v,i]=T(()=>c()),await v,i()),(f,t)=>o.value?(s(),a("div",{class:"text-body d-flex flex-column overflow-y-scroll h-100",key:o.value.ClientID},[e("div",Pe,[e("small",we,[g(u,{t:"Email"})]),e("h1",null,y(o.value.Email),1),e("div",$e,[e("small",Se,[g(u,{t:"Client ID"})]),e("small",Ce,[e("samp",null,y(o.value.ClientID),1)])])]),e("div",Ae,[g(pe,{onRefresh:t[0]||(t[0]=n=>c()),clientAssignedPeers:p.value,client:o.value},null,8,["clientAssignedPeers","client"]),o.value.ClientGroup==="Local"?(s(),P(ke,{key:0,client:o.value},null,8,["client"])):x("",!0)])])):(s(),a("div",De,[e("div",Re,[t[1]||(t[1]=e("h1",null,[e("i",{class:"bi bi-person-x"})],-1)),e("p",null,[g(u,{t:"Client does not exist"})])])]))}});export{Ne as default};
